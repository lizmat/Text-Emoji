use Test;

use Text::Emoji;

plan 21;

my %direct   is Map = :love<â¤ï¸>;
my %indirect is Map = :love<heart>;

is to-emoji(":I: :heart: :beer:"),
  ":I: â¤ï¸ ğŸº",
  "it works!";
is to-emoji(":I: :love: :beer:", %direct),
  ":I: â¤ï¸ ğŸº",
  "it works with direct additional!";
is to-emoji(":I: :love: :beer:", %indirect),
  ":I: â¤ï¸ ğŸº",
  "it works with indirect additional!";
is to-emoji(":I: :love: :beer:", :love<â¤ï¸>),
  ":I: â¤ï¸ ğŸº",
  "it works with named direct additional!";
is to-emoji(":I: :love: :beer:", :love<heart>),
  ":I: â¤ï¸ ğŸº",
  "it works with named indirect additional!";

is to-emoji("ok :+1:, not-ok :-1:"),
  "ok ğŸ‘, not-ok ğŸ‘",
  "all ok not ok ok";

is to-emoji("baby: :BABY-BOTTLE::babybottle:"),
  "baby: ğŸ¼ğŸ¼",
  "all babies ok";

is to-text(":I: â¤ï¸ ğŸº"),
  ":I: :heart: :beer:",
  "it works in reverse!";
is to-text(":I: â¤ï¸ ğŸº", %direct),
  ":I: :love: :beer:",
  "it works in reverse with direct additional!";
is to-text(":I: â¤ï¸ ğŸº", %indirect),
  ":I: :love: :beer:",
  "it works in reverse with indirect additional!";
is to-text(":I: â¤ï¸ ğŸº", :love<â¤ï¸>),
  ":I: :love: :beer:",
  "it works in reverse with named direct additional!";
is to-text(":I: â¤ï¸ ğŸº", :love<heart>),
  ":I: :love: :beer:",
  "it works in reverse with named indirect additional!";

my $clean = "A clean string with : but without emojis";
is to-emoji($clean), $clean, 'no text , still clean';
is to-text( $clean), $clean, 'no emoji , still clean';

my $raw := raw-emoji-data;
isa-ok $raw, Map, 'the raw data comes as a Map';
is $raw.elems, 1870, 'does the raw data have correct size';
is-deeply $raw<â¤ï¸ >,
  (:aliases($["heart"]),
    :category("Smileys \& Emotion"),
    :description("red heart"),
    :ios_version("6.0"),
    :tags($["love"]),
    :unicode_version(""),
  ).Map,
  'the raw emoji data looks ok';

my $by-tag := by-tag;
isa-ok $by-tag, Map::Match, 'tag data comes as a Map::Match';
is $by-tag.elems, 461, 'does the tag data have the right size';

is-deeply $by-tag<birthday>, ("ğŸ¥³ğŸˆğŸ",).Slip, 'does birthday work';
is-deeply $by-tag{/^wh/}.sort,  <ğŸ˜Œ ğŸ˜« ğŸ¤­ ğŸ¥ƒ>, 'does /^wh/ work';

# vim: expandtab shiftwidth=4
